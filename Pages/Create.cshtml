@page
@model CreateModel
@{
    ViewData["Title"] = "Créer votre chatbot";
}

<div class="container-fluid py-5">
    <div class="row justify-content-center">
        <div class="col-xxl-10">
            <!-- En-tête avec animation -->
            <div class="text-center mb-5">
                <div class="position-relative d-inline-block">
                    <h1 class="display-4 fw-bold gradient-text mb-3 floating-animation">
                        🤖 Créez votre chatbot en 5 minutes
                    </h1>
                    <div class="accent-line mx-auto mb-4"></div>
                </div>
                <p class="lead text-light opacity-75 mb-5">
                    Suivez ces étapes simples pour créer votre assistant virtuel personnalisé
                </p>
            </div>

            <!-- Barre de progression -->
            <div class="progress-container mb-5">
                <div class="step-progress">
                    <div class="step active" data-step="1">
                        <div class="step-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <span class="step-label">Entreprise</span>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-icon">
                            <i class="fas fa-upload"></i>
                        </div>
                        <span class="step-label">Documents</span>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <span class="step-label">Site Web</span>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-icon">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <span class="step-label">Configuration</span>
                    </div>
                </div>
            </div>

            <!-- Formulaire multi-étapes -->
            <form id="chatbotForm" method="post" enctype="multipart/form-data" asp-page-handler="Create" novalidate>
                @Html.AntiForgeryToken()
                
                <!-- Étape 1: Informations de l'entreprise -->
                <div class="form-step active" id="step-1">
                    <div class="step-card">
                        <div class="step-header">
                            <h3 class="step-title">
                                <i class="fas fa-building me-3"></i>
                                Informations de l'entreprise
                            </h3>
                            <p class="step-description">
                                Commençons par les informations de base de votre entreprise
                            </p>
                        </div>
                        
                        <div class="row g-4">
                            <div class="col-lg-6">
                                <div class="floating-label">
                                    <input type="text" 
                                           id="companyName" 
                                           name="CompanyName" 
                                           asp-for="CompanyName"
                                           class="form-control glass-input" 
                                           placeholder=" "
                                           required>
                                    <label for="companyName">Nom de l'entreprise *</label>
                                    <div class="input-icon">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <span asp-validation-for="CompanyName" class="text-danger validation-message"></span>
                                </div>
                            </div>
                            
                            <div class="col-lg-6">
                                <div class="floating-label">
                                    <select id="industry" 
                                            name="Industry" 
                                            asp-for="Industry"
                                            class="form-control glass-input" 
                                            required>
                                        <option value="">Sélectionnez votre secteur</option>
                                        <option value="ecommerce">E-commerce</option>
                                        <option value="tech">Technologie</option>
                                        <option value="health">Santé</option>
                                        <option value="finance">Finance</option>
                                        <option value="education">Éducation</option>
                                        <option value="restaurant">Restauration</option>
                                        <option value="real-estate">Immobilier</option>
                                        <option value="other">Autre</option>
                                    </select>
                                    <label for="industry">Secteur d'activité *</label>
                                    <div class="input-icon">
                                        <i class="fas fa-industry"></i>
                                    </div>
                                    <span asp-validation-for="Industry" class="text-danger validation-message"></span>
                                </div>
                            </div>
                            
                            <div class="col-12">
                                <div class="floating-label">
                                    <textarea id="companyDescription" 
                                              name="CompanyDescription" 
                                              asp-for="CompanyDescription"
                                              class="form-control glass-input" 
                                              placeholder=" " 
                                              rows="4"
                                              maxlength="500"></textarea>
                                    <label for="companyDescription">Description de l'entreprise</label>
                                    <div class="input-icon">
                                        <i class="fas fa-info-circle"></i>
                                    </div>
                                    <div class="character-count">
                                        <span id="descriptionCount">0</span>/500 caractères
                                    </div>
                                    <span asp-validation-for="CompanyDescription" class="text-danger validation-message"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Étape 2: Upload de documents -->
                <div class="form-step" id="step-2">
                    <div class="step-card">
                        <div class="step-header">
                            <h3 class="step-title">
                                <i class="fas fa-upload me-3"></i>
                                Documents de l'entreprise
                            </h3>
                            <p class="step-description">
                                Téléchargez vos documents pour enrichir les connaissances du chatbot
                            </p>
                        </div>
                        
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h4>Glissez-déposez vos fichiers ici</h4>
                            <p class="text-muted">ou cliquez pour sélectionner</p>
                            <input type="file" 
                                   id="documents" 
                                   name="Documents" 
                                   asp-for="Documents"
                                   multiple 
                                   accept=".pdf,.doc,.docx,.txt,.csv"
                                   class="file-input">
                            <div class="upload-info">
                                <small>Formats acceptés: PDF, DOC, DOCX, TXT, CSV (max 10MB par fichier)</small>
                            </div>
                        </div>
                        
                        <!-- Liste des fichiers uploadés -->
                        <div class="uploaded-files" id="uploadedFiles"></div>
                    </div>
                </div>

                <!-- Étape 3: Site web -->
                <div class="form-step" id="step-3">
                    <div class="step-card">
                        <div class="step-header">
                            <h3 class="step-title">
                                <i class="fas fa-globe me-3"></i>
                                Site web de l'entreprise
                            </h3>
                            <p class="step-description">
                                Connectez votre site web pour que le chatbot puisse répondre aux questions spécifiques
                            </p>
                        </div>
                        
                        <div class="row g-4">
                            <div class="col-12">
                                <div class="url-analyzer-section">
                                    <div class="floating-label">
                                        <input type="url" 
                                               id="websiteUrl" 
                                               name="WebsiteUrl" 
                                               asp-for="WebsiteUrl"
                                               class="form-control glass-input url-input" 
                                               placeholder=" "
                                               pattern="https?://.+">
                                        <label for="websiteUrl">URL du site web</label>
                                        <div class="input-icon">
                                            <i class="fas fa-globe"></i>
                                        </div>
                                        <span asp-validation-for="WebsiteUrl" class="text-danger validation-message"></span>
                                    </div>
                                    
                                    <!-- Bouton Analyser -->
                                    <div class="analyze-button-container mt-3" style="display: none;">
                                        <button type="button" 
                                                id="analyzeBtn" 
                                                class="btn btn-analyze">
                                            <i class="fas fa-search me-2"></i>
                                            Analyser le site web
                                        </button>
                                    </div>
                                    
                                    <!-- Zone de statut d'analyse -->
                                    <div class="analysis-status" id="analysisStatus" style="display: none;">
                                        <!-- État de chargement -->
                                        <div class="analysis-loading" id="analysisLoading">
                                            <div class="loading-spinner">
                                                <div class="spinner"></div>
                                            </div>
                                            <div class="loading-text">
                                                <h5>Analyse en cours...</h5>
                                                <p class="loading-step">Vérification de l'accessibilité du site</p>
                                                <div class="progress-bar">
                                                    <div class="progress-fill"></div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Résultat de l'analyse -->
                                        <div class="analysis-result" id="analysisResult" style="display: none;">
                                            <div class="result-success">
                                                <div class="result-icon">
                                                    <i class="fas fa-check-circle"></i>
                                                </div>
                                                <div class="result-content">
                                                    <h5>Site web analysé avec succès !</h5>
                                                    <p id="siteTitle">Site accessible et prêt pour l'intégration</p>
                                                    <div class="site-info">
                                                        <span class="info-badge">
                                                            <i class="fas fa-shield-alt me-1"></i>
                                                            HTTPS Sécurisé
                                                        </span>
                                                        <span class="info-badge">
                                                            <i class="fas fa-tachometer-alt me-1"></i>
                                                            Temps de réponse: <span id="responseTime">250ms</span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Résultat d'erreur -->
                                        <div class="analysis-error" id="analysisError" style="display: none;">
                                            <div class="result-error">
                                                <div class="result-icon">
                                                    <i class="fas fa-exclamation-triangle"></i>
                                                </div>
                                                <div class="result-content">
                                                    <h5>Erreur lors de l'analyse</h5>
                                                    <p id="errorMessage">Site non accessible ou URL invalide</p>
                                                    <button type="button" class="btn btn-retry" onclick="retryAnalysis()">
                                                        <i class="fas fa-redo me-2"></i>
                                                        Réessayer
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Options d'analyse (s'affichent après succès) -->
                                    <div class="crawl-options mt-3" id="crawlOptions" style="display: none;">
                                        <div class="form-check">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   id="crawlWebsite" 
                                                   name="CrawlWebsite"
                                                   asp-for="CrawlWebsite">
                                            <label class="form-check-label text-light" for="crawlWebsite">
                                                <i class="fas fa-spider me-2"></i>
                                                Analyser automatiquement le contenu du site web
                                            </label>
                                        </div>
                                        <div class="form-check mt-2">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   id="analyzeSitemap" 
                                                   name="AnalyzeSitemap">
                                            <label class="form-check-label text-light" for="analyzeSitemap">
                                                <i class="fas fa-sitemap me-2"></i>
                                                Inclure l'analyse du sitemap XML
                                            </label>
                                        </div>
                                        <div class="form-check mt-2">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   id="extractMetadata" 
                                                   name="ExtractMetadata">
                                            <label class="form-check-label text-light" for="extractMetadata">
                                                <i class="fas fa-tags me-2"></i>
                                                Extraire les métadonnées et mots-clés
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Aperçu du site -->
                            <div class="col-12">
                                <div class="website-preview" id="websitePreview" style="display: none;">
                                    <h5>Aperçu du site web</h5>
                                    <div class="preview-card">
                                        <div class="preview-loading">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Chargement...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Étape 4: Configuration avancée -->
                <div class="form-step" id="step-4">
                    <div class="step-card">
                        <div class="step-header">
                            <h3 class="step-title">
                                <i class="fas fa-cogs me-3"></i>
                                Configuration du chatbot
                            </h3>
                            <p class="step-description">
                                Personnalisez le comportement et l'apparence de votre chatbot
                            </p>
                        </div>
                        
                        <div class="row g-4">
                            <div class="col-lg-6">
                                <div class="floating-label">
                                    <input type="text" 
                                           id="chatbotName" 
                                           name="ChatbotName" 
                                           asp-for="ChatbotName"
                                           class="form-control glass-input" 
                                           placeholder=" "
                                           value="Assistant">
                                    <label for="chatbotName">Nom du chatbot</label>
                                    <div class="input-icon">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-6">
                                <div class="floating-label">
                                    <select id="language" 
                                            name="Language" 
                                            asp-for="Language"
                                            class="form-control glass-input">
                                        <option value="fr">Français</option>
                                        <option value="en">English</option>
                                        <option value="es">Español</option>
                                    </select>
                                    <label for="language">Langue</label>
                                    <div class="input-icon">
                                        <i class="fas fa-language"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-12">
                                <div class="floating-label">
                                    <textarea id="welcomeMessage" 
                                              name="WelcomeMessage" 
                                              asp-for="WelcomeMessage"
                                              class="form-control glass-input" 
                                              placeholder=" " 
                                              rows="3">Bonjour ! Je suis votre assistant virtuel. Comment puis-je vous aider aujourd'hui ?</textarea>
                                    <label for="welcomeMessage">Message de bienvenue</label>
                                    <div class="input-icon">
                                        <i class="fas fa-comment"></i>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>

                <!-- Boutons de navigation -->
                <div class="navigation-buttons mt-5">
                    <div class="d-flex justify-content-between">
                        <button type="button" 
                                id="prevBtn" 
                                class="btn btn-outline-secondary btn-lg px-4"
                                style="display: none;">
                            <i class="fas fa-chevron-left me-2"></i>
                            Précédent
                        </button>
                        
                        <div class="ms-auto">
                            <button type="button" 
                                    id="nextBtn" 
                                    class="btn btn-primary btn-lg px-4 me-3">
                                Suivant
                                <i class="fas fa-chevron-right ms-2"></i>
                            </button>
                            
                            <button type="submit" 
                                    id="submitBtn" 
                                    class="btn btn-success btn-lg px-4"
                                    style="display: none;"
                                    disabled>
                                <i class="fas fa-rocket me-2"></i>
                                Créer mon chatbot
                            </button>
                        </div>
                    </div>
                </div>
            </form>
            
            <!-- Section de chat -->
            <div class="text-center mt-5">
                <div class="glass-card p-4">
                    <h4 class="text-primary mb-3">Besoin d'aide ?</h4>
                    <p class="mb-3">Notre assistant peut vous guider dans la création de votre chatbot</p>
                    <button class="btn btn-outline-primary btn-lg px-5" id="quickStart" title="Chat simple" aria-label="Chat simple">
                        <i class="fas fa-comments me-2"></i>
                        Parler à notre assistant
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/create-form.js"></script>
}

